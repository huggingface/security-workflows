---
name: Update Major Version Tag

on:
  workflow_dispatch:
    inputs:
      source_tag:
        description: 'Full version (ex: v1.0.1)'
        required: true
        type: string
      major_tag:
        description: 'Tag major version to create (ex: v1)'
        required: true
        type: string

jobs:
  update-major-tag:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout
        uses: actions/checkout@v6
        with:
          fetch-depth: 0
      
      - name: Check if source tag exists
        run: |
          if ! git rev-parse "${{ inputs.source_tag }}" >/dev/null 2>&1; then
            echo "Tag ${{ inputs.source_tag }} does not exist."
            exit 1
          fi
          echo "Source tag found: ${{ inputs.source_tag }}"
      
      - name: Delete existing major tag (if exists)
        run: |
          if git rev-parse "${{ inputs.major_tag }}" >/dev/null 2>&1; then
            git push origin :refs/tags/${{ inputs.major_tag }} || true
            echo "Tag ${{ inputs.major_tag }} deleted"
          fi
      
      - name: Create and push major tag
        run: |
          git tag -f ${{ inputs.major_tag }} ${{ inputs.source_tag }}
          git push origin ${{ inputs.major_tag }} --force
          echo "Tag ${{ inputs.major_tag }} has been created and redirect to ${{ inputs.source_tag }}"